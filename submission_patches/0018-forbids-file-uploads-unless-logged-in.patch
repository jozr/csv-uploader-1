From 38b5565467ae83661f1ffea600180ee748d7edd8 Mon Sep 17 00:00:00 2001
From: jozwright <jozwright@gmail.com>
Date: Wed, 3 Dec 2014 00:47:56 -0800
Subject: [PATCH 18/23] forbids file uploads unless logged in

---
 main.rb | 16 ++++++++++------
 1 file changed, 10 insertions(+), 6 deletions(-)

diff --git a/main.rb b/main.rb
index bea011b..cd91a3f 100644
--- a/main.rb
+++ b/main.rb
@@ -13,11 +13,15 @@ end
 
 post '/' do
   link = "<a href=\"/\">Again?</a>"
-  if params['upload']
-    Detail.upload(params['upload'])
-    flash[:success] = "The total amount of revenue is $#{Detail.latest_upload_revenue}0. Lookin' good!<br />#{link}"    
-  else
-    flash[:error] = "You did not select a file to upload.<br />#{link}"
+  if @@current_user_id.nil?
+  	flash[:error] = 'You must login to upload a file.'
+  else 
+  	if params['upload']
+      Detail.upload(params['upload'])
+      flash[:success] = "The total amount of revenue is $#{Detail.latest_upload_revenue}0. Lookin' good!<br />#{link}"    
+    else
+      flash[:error] = "You did not select a file to upload.<br />#{link}"
+    end
   end
 end
 
@@ -35,7 +39,7 @@ end
 
 get '/auth/logout' do
   if @@current_user_id.nil?
-    flash[:success] = 'Nobody is logged in!'
+    flash[:error] = 'Nobody is logged in!'
   else
   	@@current_user_id = nil
     flash[:success] = 'You have successfully logged out!'
-- 
1.8.4

