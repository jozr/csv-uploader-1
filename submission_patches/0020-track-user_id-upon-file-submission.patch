From bcdcb86de828db038cbf7ecaf89a89de7e1cfa68 Mon Sep 17 00:00:00 2001
From: jozwright <jozwright@gmail.com>
Date: Wed, 3 Dec 2014 01:22:18 -0800
Subject: [PATCH 20/23] track user_id upon file submission

---
 lib/detail.rb | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lib/detail.rb b/lib/detail.rb
index ff566ca..0520936 100644
--- a/lib/detail.rb
+++ b/lib/detail.rb
@@ -21,6 +21,7 @@ class Detail < ActiveRecord::Base
     file_name = File.absolute_path('uploads/' + file[:filename]) 
     DB.exec("COPY details(purchaser_name, description, price, amount, address, merchant_name) FROM '#{file_name}' WITH CSV HEADER DELIMITER AS ',';")
     DB.exec("UPDATE details SET created_at = NOW() WHERE created_at IS NULL;")
+    DB.exec("UPDATE details SET user_id = #{@@current_user_id} WHERE user_id IS NULL;")
   end
 
   def self.latest_upload_revenue
-- 
1.8.4

